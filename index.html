<!DOCTYPE html>
<html>
<head>
    <title>Cloudflare Signaling Test</title>
</head>
<body>
    <h1>Cloudflare Signaling Test</h1>
    <button id="joinButton">Join Call</button>
    <div id="output"></div>

    <script>
        const outputDiv = document.getElementById('output');
        const joinButton = document.getElementById('joinButton');
        let websocket;
        let sessionId;

        function logMessage(message) {
            outputDiv.innerHTML += `<p>${message}</p>`;
        }

        joinButton.addEventListener('click', () => {
            websocket = new WebSocket('ws://localhost:3000'); // Adjust if your server is on a different host/port

            websocket.onopen = () => {
                logMessage('Connected to WebSocket server');
                const clientId = Math.random().toString(36).substring(2, 15); // Generate a random client ID
                websocket.send(JSON.stringify({ type: 'joinCall', clientId: clientId }));
            };

            websocket.onmessage = (event) => {
                const message = JSON.parse(event.data);
                logMessage(`Received: ${event.data}`); // Log raw message

                if (message.type === 'sessionCreated') {
                    sessionId = message.sessionId;
                    logMessage(`Session ID: ${sessionId}`);
                    //TODO: Now that we have session we create offer by making peer connection etc. and send through SDP offer, ICE candidates
                }
                // Add handlers for sdpAnswer, iceCandidate messages here
            };

            websocket.onclose = () => {
                logMessage('Disconnected from WebSocket server');
            };

            websocket.onerror = (error) => {
                logMessage(`WebSocket error: ${error}`);
            };
        });
    </script>
</body>
</html>